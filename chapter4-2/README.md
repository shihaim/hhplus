# [Chapter4-2 - 적은 부하로 트래픽 처리하기]
### 좌석 조회 인덱싱을 통한 조회 성능 개선
 - 콘서트 코드와 콘서트 날짜로 조건을 걸어서 조회
 - 현재 Seat 테이블의 PK는 seat_id이고, FK가 concert_code, concert_date로 FK를 통한 세컨더리 인덱스가 걸려있는 중
 - 하지만 concert_code와 concert_date는 현재 구조상 카디널리티가 상당히 낮은편(중복도가 높음)
 - 조건 절에 status를 포함시켜서 중복도를 조금이라도 낮추는 방법으로 인덱싱 적용
 - concert_code, concert_date만으로 조회를 하는 경우보다 status를 포함시켜서 조회하는 경우 속도 개선율이 20~30% 상승
 - 그리고 또한 클라이언트에게 response를 전송하는 경우 status가 예매 가능한 상태의 데이터를 조회할 경우 조회되는 양도 점점 적어지므로 조회 속도가 상승
   - 만약 Front-Side에서 예매가 된 좌석과 예매가 안된 좌석을 구분 지을 때 default를 예매가 된 좌석으로 보여주고, 
     예매가 안 된 좌석의 리스트를 보내줌으로써 더 좋은 성능을 올려줄 것이라 기대

#### 보완해야할 점
 - 결제시 Seat의 status가 NONE -> COMPLETE로 UPDATE가 발생하므로 인덱스 재정렬에 대한 오버헤드가 발생하므로 다른 방식 또한 생각 필요
   - 초실시간성으로 데이터를 보여줄 필요가 없으므로 캐시 방식 채용하고 캐시 Evict 주기를 짧게 가져감.
   - 조회 성능을 조금 포기하더라도 status 변경에도 재정렬하지 않는 인덱스로 설정

### Redis를 이용한 대기열 토큰 및 순번 성능 개선
 - 기존 RDB로 발급된 토큰을 저장하여 AUTO_INCREMNET 방식으로 순번을 지정
 - INSERT 되는 양이 많아질 수록 DB I/O가 많이 발생하여 성능이 저하됨.
 - In-Memory DB인 Redis를 이용하여 Sorted Set 자료구조를 통한 대기열 토큰 발급하여 성능 개선
 - 대기열 순번 조회 폴링시 ZRANK를 이용하여 대기열 순번을 조회하여 대기열 토큰 조회 관련 DB I/O를 제거
